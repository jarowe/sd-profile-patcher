---
phase: 01-constellation-scene
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/constellation/scene/HoverLabel.jsx
  - src/constellation/ui/TimelineScrubber.css
  - src/constellation/scene/ConstellationCanvas.jsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Hovering over any sphere shows a 3D billboard label with the node's title, type, and date"
    - "Timeline scrubber appears on the left side of the viewport"
    - "Clicking empty space in the 3D scene clears focus and restores all nodes to full opacity"
  artifacts:
    - path: "src/constellation/scene/HoverLabel.jsx"
      provides: "Billboard label showing title, type badge, and formatted date"
      contains: "node.type"
    - path: "src/constellation/ui/TimelineScrubber.css"
      provides: "Left-positioned timeline scrubber"
      contains: "left:"
    - path: "src/constellation/scene/ConstellationCanvas.jsx"
      provides: "Canvas with onPointerMissed handler that clears focus"
      contains: "onPointerMissed"
  key_links:
    - from: "src/constellation/scene/ConstellationCanvas.jsx"
      to: "src/constellation/store.js"
      via: "clearFocus called on pointer miss"
      pattern: "onPointerMissed.*clearFocus"
---

<objective>
Fix three UAT gaps from Phase 1 verification: hover label missing type/date, timeline scrubber on wrong side, and clicking empty space not clearing focus.

Purpose: Close all remaining Phase 1 UAT issues so the constellation scene passes full acceptance testing.
Output: Three targeted file edits resolving all diagnosed gaps.
</objective>

<execution_context>
@C:\Users\rowej\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\rowej\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-constellation-scene/01-UAT.md
@src/constellation/scene/HoverLabel.jsx
@src/constellation/ui/TimelineScrubber.css
@src/constellation/scene/ConstellationCanvas.jsx
@src/constellation/store.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add type and date to HoverLabel</name>
  <files>src/constellation/scene/HoverLabel.jsx</files>
  <action>
    Edit HoverLabel.jsx to display node.type and node.date below the title.

    Currently line 38 renders only `{node.title}`. Replace the single Text element with a group of three Drei Text elements stacked vertically inside the existing Billboard:

    1. Title text (existing): fontSize 1.2, color white, anchorY "bottom". Keep outlineWidth 0.05 and outlineColor "black".
    2. Type text (new): fontSize 0.7, color matching the node's type color (use a simple mapping -- milestone: "#FFD700", person: "#4FC3F7", moment: "#AB47BC", idea: "#66BB6A", project: "#FF7043", place: "#26C6DA", default: "#AAAAAA"), anchorY "bottom", positioned below title with a y-offset of -0.3 from the title text. Capitalize first letter of type string. Add same outline as title.
    3. Date text (new): fontSize 0.6, color "rgba(255,255,255,0.6)", anchorY "bottom", positioned below type with an additional y-offset of -0.3. Format the date string as a readable date (e.g., "Aug 15, 2005") using `new Date(node.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })`. Add same outline as title.

    Use a group element to contain all three Text elements. The Billboard position stays the same (node position + yOffset). The three Text elements use relative y positions within the group: title at y=0, type at y=-1.4, date at y=-2.4.

    Update the JSDoc comment at top to reflect that the label now shows title, type, and date.
  </action>
  <verify>Run `npx vite build` -- no build errors. Navigate to /constellation in dev, hover a node, and confirm label shows title, colored type badge, and formatted date.</verify>
  <done>Hovering any node shows a three-line billboard label: title (white), type (color-coded), and date (dimmed) -- matching UAT test 2 expectation.</done>
</task>

<task type="auto">
  <name>Task 2: Move timeline scrubber to left side</name>
  <files>src/constellation/ui/TimelineScrubber.css</files>
  <action>
    Edit TimelineScrubber.css to position the scrubber on the left side of the viewport instead of the right.

    Line 3: Change `right: 1.5rem` to `left: 1.5rem` on the `.timeline-scrubber` rule.

    Line 23: Change `right: 0` to `left: 0` on the `.timeline-scrubber__epoch` rule. This ensures epoch labels align to the left edge of their container, reading naturally from the left side.

    No other CSS changes needed -- the flex layout, track, thumb, and media query all work the same regardless of side.
  </action>
  <verify>Run `npx vite build` -- no build errors. Navigate to /constellation in dev, confirm the timeline scrubber rail and epoch labels appear on the LEFT side of the viewport. Drag the thumb -- behavior should be identical to before, just on the left.</verify>
  <done>Timeline scrubber renders on the left side of the viewport with epoch labels aligned left -- matching UAT test 5 expectation.</done>
</task>

<task type="auto">
  <name>Task 3: Add onPointerMissed to clear focus on empty-space click</name>
  <files>src/constellation/scene/ConstellationCanvas.jsx</files>
  <action>
    Edit ConstellationCanvas.jsx to clear focus when the user clicks empty 3D space (no node hit).

    1. At the top of the ConstellationCanvas component function (around line 56, near the existing store subscriptions), add:
       `const clearFocus = useConstellationStore((s) => s.clearFocus);`

    2. On the Canvas element (line 91), add the `onPointerMissed` prop:
       `onPointerMissed={() => clearFocus()}`

    This is a R3F Canvas prop that fires when a pointer event (click/tap) doesn't intersect any mesh with an onClick handler. The existing NodeCloud onClick uses `e.stopPropagation()` to prevent bubbling to Canvas, so node clicks will NOT trigger onPointerMissed. Only clicks on empty background space will fire it.

    No other changes needed -- clearFocus already sets focusedNodeId to null and filterEntity to null in the store (line 21 of store.js), which triggers the existing dimming restore logic in NodeCloud.
  </action>
  <verify>Run `npx vite build` -- no build errors. Navigate to /constellation in dev, click a node to focus it (nodes dim). Then click on empty space (not on any node). All nodes should restore to full opacity and the detail panel should close -- matching the behavior that ESC already provides.</verify>
  <done>Clicking empty space in the 3D scene clears focus, restores all nodes to full opacity, and closes the detail panel -- matching UAT test 10 expectation.</done>
</task>

</tasks>

<verification>
After all three tasks:

1. `npx vite build` completes without errors
2. Hover any node -- label shows title, type (colored), and date (formatted)
3. Timeline scrubber is on the LEFT side of the viewport
4. Click a node (focus + dim) then click empty space -- focus clears, all nodes restore
5. ESC still works for clearing focus (no regression)
6. No console errors during any of these interactions
</verification>

<success_criteria>
All three UAT gaps from 01-UAT.md are resolved:
- UAT Test 2 (Hover Labels): title + type + date visible on hover
- UAT Test 5 (Timeline Scrubber): positioned on left side
- UAT Test 10 (Focus Clearing): clicking empty space clears focus
</success_criteria>

<output>
After completion, create `.planning/phases/01-constellation-scene/01-04-SUMMARY.md`
</output>
